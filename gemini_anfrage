‚Äã # SYSTEM SPEZIFIKATION: BEERRACE PRO

## 1. √úbersicht
Ein webbasiertes Event-Management-System zur Zeit- und Punkterfassung f√ºr Rallyes (z.B. Bollerwagenrennen). 
Das System unterst√ºtzt QR-Code-Scanning, Live-Ranglisten und administrative Korrekturen.

## 2. Infrastruktur & Verzeichnisse
/beerrace
‚îÇ
‚îú‚îÄ‚îÄ /api              # Endpunkte f√ºr AJAX-Abfragen (Live-Daten, Suche)
‚îú‚îÄ‚îÄ /assets           # CSS-Stylesheets und JS-Bibliotheken (QR-Scanner)
‚îú‚îÄ‚îÄ /data             # SQLite Datenbank (Ben√∂tigt Schreibrechte!)
‚îú‚îÄ‚îÄ /includes         # Datenbankverbindung und globale Hilfsfunktionen
‚îú‚îÄ‚îÄ /modules          # Kernmodule (Frontend-Logik)
‚îú‚îÄ‚îÄ index.php         # Zentraler Router & Layout
‚îî‚îÄ‚îÄ setup.php         # Initialisierung und Reset-Schutz

## 3. Datenbank-Schema (SQLite)


### Tabelle: users
- id (INT, PK): Eindeutige User-ID
- username (TEXT): Login-Name
- password (TEXT): Gehashtes Passwort (BCRYPT)
- name (TEXT): Anzeigename (z.B. Station 1)
- login_token (TEXT): QR-Login-Token f√ºr Helfer

### Tabelle: stations
- id (INT, PK): Stationsnummer
- name (TEXT): Name der Station
- type (TEXT): Erfassungstyp (points, time, start_time, end_time)

### Tabelle: participants
- id (INT, PK): Interne Team-ID
- teamname (TEXT): Name des Teams
- p1 / p2 (TEXT): Teilnehmernamen
- custom_id (TEXT, Unique): Externe ID (z.B. auf QR-Code gedruckt)

### Tabelle: results
- id (INT, PK): Eindeutiger Record
- participant_id (TEXT): Fremdschl√ºssel zu participants
- station_id (INT): Fremdschl√ºssel zu stations
- checkin_at (DATETIME): Zeitstempel Start der Station
- checkout_at (DATETIME): Zeitstempel Abschluss der Station
- points (INT): Manuelle Punktzahl
- penalty_points (INT): Strafpunkte (‚ö†Ô∏è)
- time_seconds (INT): Erfasste Zeit in Sekunden
- bottles (INT): Anzahl getrunkener Biere (üç∫)
- status (TEXT): 'active' oder 'done'
- type (TEXT): Kopie des Stationstyps zur Zeit der Erfassung

## 4. Funktionslogik


### A. Zeitberechnung (results_final.php)
1. Netto-Race = MAX(time_seconds @ end_time) - MIN(time_seconds @ start_time)
2. Additive-Zeit = SUM(time_seconds @ type 'time')
3. Straf-Zeit = SUM(penalty_points) * Konfigurationswert (z.B. 60 Sek)
4. Gesamt-Zeit = Netto-Race + Additive-Zeit + Straf-Zeit

### B. Zugriffsschutz
- Login-Pflicht f√ºr alle Module au√üer Display (optional).
- `setup.php` mit Datei-Pr√ºfungs-Sperre gegen versehentliches L√∂schen.

## 5. Schnittstellen
- QR-Scanner: Integration via html5-qrcode.js.
- Export: CSV-Stream mit UTF-8 BOM f√ºr direkte Excel-Kompatibilit√§t.
- Live-API: JSON-Output f√ºr Team-Lookup; HTML-Partial f√ºr Live-Monitor.
