​# System-Spezifikation: Beerrace – Modularer RaceTracker

## 1. Vision & Branding
**Name:** Beerrace
**Zweck:** Webbasierte Verwaltung für ein Bierkastenrennen. Fokus auf Zeiterfassung, Punktemanagement und Trink-Kontrolle (Trinken ist nur an den Stationen erlaubt, um Verschütten zu verhindern).
**Design:** Simpel, professionell, mobil-optimiert (Responsive), große Touch-Flächen für die Bedienung im Feld.

## 2. Technische Basis
* **Backend:** PHP 7.4+ (modularer Aufbau).
* **Datenbank:** SQLite 3 (leichtgewichtig, dateibasiert).
* **Frontend:** HTML5, CSS3, JavaScript (AJAX für Live-Updates).
* **Bibliotheken:** html5-qrcode (via CDN) für plattformunabhängiges Kamera-Scanning im Browser.

## 3. Datenbank-Schema (SQLite)
* **users**: `id`, `username`, `password` (gehasht), `name`, `login_token` (für persistenten QR-Login).
* **stations**: `id`, `name`.
* **participants**: `id`, `teamname`, `p1`, `p2`, `custom_id` (Die gescannte Hex-ID/String vom Teilnehmer-Tag).
* **results**: 
    * `id` (Primary Key)
    * `timestamp` (Default: CURRENT_TIMESTAMP)
    * `participant_id` (Zuweisung via custom_id oder primary key)
    * `station_id` (FK stations)
    * `user_id` (FK users / Helfer)
    * `points` (INT)
    * `time_seconds` (INT)
    * `bottles` (INT): Anzahl der an dieser Station getrunkenen Flaschen.
    * `type` (TEXT: 'points' oder 'time').

## 4. Funktionsumfang der Module

### A. Authentifizierung & Sessions
* **Login-Methoden:** Klassisch (User/Pass) oder via QR-Code (Token-basiert).
* **Persistence:** Bei Erfolg wird ein `login_token` in einem Cookie ("remember_me") für 30 Tage gespeichert.
* **Logout:** Löscht Session und Cookie.

### B. Modul: Station (Erfassung)
* **Stationswahl:** Helfer wählt seine Station aus einer Liste (wird in Session gespeichert).
* **QR-Scanner:** Kamera-Interface zur Erfassung der Teilnehmer-ID.
* **Manueller Fallback:** Textfeld zur händischen Eingabe der ID, falls der Scan fehlschlägt.
* **Dateneingabe:** * Pflichtfeld: Anzahl geleerter Flaschen (`bottles`).
    * Wahlweise: Zusatzpunkte oder Zeit (Eingabe in Min:Sek, Speicherung in Sekunden).
* **Speichern:** Erzeugt einen Eintrag in der `results`-Tabelle.

### C. Modul: Live-Anzeige (Display)
* **Live-Ticker:** AJAX-Polling alle 10 Sekunden auf `api/live_data.php`.
* **Anzeige:** Tabelle mit Teamname, Station, Ergebnis (Punkte oder Zeit) und der Anzahl der Flaschen (inkl. Bier-Icon-Visualisierung).

### D. Modul: Administration
* **Teilnehmer-Management:** Anlegen von Teams inkl. QR-Scanner, um Startnummern/IDs direkt zuzuweisen.
* **Stations-Management:** CRUD-Operationen für Stationen.
* **Daten-Audit:** Komplette Ergebnisliste einsehen, Werte korrigieren (Edit) oder Einträge löschen.
* **Passwort-Management:** Benutzer können ihr eigenes Passwort ändern.

## 5. Verzeichnisstruktur
* `/index.php` (Zentrales Routing & Template)
* `/setup.php` (Datenbank- und Admin-Initialisierung)
* `/data/database.sqlite` (Datenbankverzeichnis)
* `/includes/db.php` (Datenbankverbindung)
* `/modules/` (login.php, station.php, display.php, admin.php, profile.php, logout.php)
* `/api/live_data.php` (JSON/HTML Output für AJAX)
* `/assets/style.css` (Zentrales Stylesheet)

## 6. Implementierungshinweise für die KI
* Nutze die `SQLite3`-Klasse von PHP.
* Implementiere `password_hash()` und `password_verify()` für alle Benutzerkonten.
* Der QR-Scanner muss in den Modulen `login`, `station` und `admin` (Teilnehmer-Anlage) verfügbar sein.
* Achte beim `INSERT` in `results` darauf, dass die `participant_id` konsistent gematcht wird (custom_id bevorzugt).
